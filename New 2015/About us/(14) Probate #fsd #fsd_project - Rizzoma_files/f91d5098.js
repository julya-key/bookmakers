gadgets=window.gadgets||{};shindig=window.shindig||{};osapi=window.osapi||{};if(!window.gadgets["config"]){gadgets.config=function(){var h;var i={};var b={};var d=false;function c(k,m){for(var l in m){if(!m.hasOwnProperty(l)){continue}if(typeof k[l]==="object"&&typeof m[l]==="object"){c(k[l],m[l])}else{k[l]=m[l]}}}function j(){var q=(b["core.io"]||{})["jsPath"]||null,p=[],s=0;var l=document.scripts||document.getElementsByTagName("script");if(!l||l.length==0){return p}for(var m=0;m<l.length;++m){var r=l[m].src,o=q!=null&&r&&r.indexOf(q)||-1;if(o!=-1&&/.*[.]js.*[?&]c=[01](#|&|$).*/.test(r.substring(o+q.length))){p[s++]=l[m]}}if(!p.length){var k=l[l.length-1];if(k.src){p[0]=k}}return p}function a(k){var l="";if(k.nodeType==3||k.nodeType==4){l=k.nodeValue}else{if(k.innerText){l=k.innerText}else{if(k.innerHTML){l=k.innerHTML}else{if(k.firstChild){var m=[];for(var n=k.firstChild;n;n=n.nextSibling){m.push(a(n))}l=m.join("")}}}}return l}function f(l){var k;try{k=(new Function("return ("+l+"\n)"))()}catch(m){}if(typeof k==="object"){return k}try{k=(new Function("return ({"+l+"\n})"))()}catch(m){}return typeof k==="object"?k:{}}function g(q){var k=j();if(!k.length){return}for(var p=0;p<k.length;p++){var m=a(k[p]);var l=f(m);if(h.f&&h.f.length==1){var o=h.f[0];if(!l[o]){var n={};n[h.f[0]]=l;l=n}}c(q,l);var r=window.___cfg;if(r){c(q,r)}}}function e(o){for(var l in i){if(i.hasOwnProperty(l)){var n=i[l];for(var m=0,k=n.length;m<k;++m){o(l,n[m])}}}}return{register:function(m,l,k,n){var o=i[m];if(!o){o=[];i[m]=o}o.push({validators:l||{},callback:k,callOnUpdate:n});if(d&&k){k(b)}},get:function(k){if(k){return b[k]||{}}return b},init:function(l,k){h=window.___jsl||{};c(b,l);g(b);var m=window.___config||{};c(b,m);e(function(r,q){var p=b[r];if(p&&!k){var n=q.validators;for(var o in n){if(n.hasOwnProperty(o)){if(!n[o](p[o])){throw new Error('Invalid config value "'+p[o]+'" for parameter "'+o+'" in component "'+r+'"')}}}}if(q.callback){q.callback(b)}});d=true},update:function(k,o){var n=[];e(function(q,p){if(k.hasOwnProperty(q)||(o&&b&&b[q])){if(p.callback&&p.callOnUpdate){n.push(p.callback)}}});b=o?{}:b||{};c(b,k);for(var m=0,l=n.length;m<l;++m){n[m](b)}},clear:function(){gadgets.warn("This method is for testing.");var k;h=k;b={};d=false}}}()}(function(){gadgets.config.EnumValidator=function(d){var c=[];if(arguments.length>1){for(var b=0,a;(a=arguments[b]);++b){c.push(a)}}else{c=d}return function(f){for(var e=0,g;(g=c[e]);++e){if(f===c[e]){return true}}return false}};gadgets.config.RegExValidator=function(a){return function(b){return a.test(b)}};gadgets.config.ExistsValidator=function(a){return typeof a!=="undefined"};gadgets.config.NonEmptyStringValidator=function(a){return typeof a==="string"&&a.length>0};gadgets.config.BooleanValidator=function(a){return typeof a==="boolean"};gadgets.config.LikeValidator=function(a){return function(c){for(var d in a){if(a.hasOwnProperty(d)){var b=a[d];if(!b(c[d])){return false}}}return true}}})();var safeJSON=window.safeJSON;var tamings___=window.tamings___||[];var bridge___;var caja___=window.caja___;var ___=window.___;gadgets.util=gadgets.util||{};gadgets.util.makeClosure=function(d,f,e){var c=[];for(var b=2,a=arguments.length;b<a;++b){c.push(arguments[b])}return function(){var g=c.slice();for(var k=0,h=arguments.length;k<h;++k){g.push(arguments[k])}return f.apply(d,g)}};gadgets.util.makeEnum=function(b){var c,a,d={};for(c=0;(a=b[c]);++c){d[a]=a}return d};gadgets.util.shouldPollXhrReadyStateChange=function(){if(document.all&&!document.querySelector){return true}return false};tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.util,"makeClosure"],[gadgets.util,"makeEnum"],[gadgets.util,"shouldPollXhrReadyStateChange"]])});gadgets.util=gadgets.util||{};(function(){var b="http://www.w3.org/1999/xhtml";function a(e,d){var g=d||{};for(var f in g){if(g.hasOwnProperty(f)){e[f]=g[f]}}}function c(f,e){var d=["<",f];var h=e||{};for(var g in h){if(h.hasOwnProperty(g)){d.push(" ");d.push(g);d.push('="');d.push(gadgets.util.escapeString(h[g]));d.push('"')}}d.push("></");d.push(f);d.push(">");return d.join("")}gadgets.util.createElement=function(e){var d;if((!document.body)||document.body.namespaceURI){try{d=document.createElementNS(b,e)}catch(f){}}return d||document.createElement(e)};gadgets.util.createIframeElement=function(f){var h=gadgets.util.createElement("iframe");try{var d=c("iframe",f);var e=gadgets.util.createElement(d);if(e&&((!h)||((e.tagName==h.tagName)&&(e.namespaceURI==h.namespaceURI)))){h=e}}catch(g){}a(h,f);return h};gadgets.util.getBodyElement=function(){if(document.body){return document.body}try{var e=document.getElementsByTagNameNS(b,"body");if(e&&(e.length==1)){return e[0]}}catch(d){}return document.documentElement||document}})();gadgets.log=(function(){var e=1;var a=2;var f=3;var c=4;var d=function(i){b(e,i)};gadgets.warn=function(i){b(a,i)};gadgets.error=function(i){b(f,i)};gadgets.setLogLevel=function(i){h=i};function b(j,i){if(typeof g==="undefined"){g=window.console?window.console:window.opera?window.opera.postError:null}if(j<h||!g){return}if(j===a&&g.warn){g.warn(i)}else{if(j===f&&g.error){g.error(i)}else{if(g.log){g.log(i)}}}}d.INFO=e;d.WARNING=a;d.NONE=c;var h=e;var g;return d})();tamings___.push(function(a){caja___.whitelistFuncs([[gadgets,"log"],[gadgets,"warn"],[gadgets,"error"],[gadgets,"setLogLevel"]]);caja___.whitelistProps([[gadgets.log,"INFO"],[gadgets.log,"WARNING"],[gadgets.log,"ERROR"],[gadgets.log,"NONE"]])});gadgets.util=gadgets.util||{};gadgets.util.attachBrowserEvent=function(c,b,d,a){if(typeof c.addEventListener!="undefined"){c.addEventListener(b,d,a)}else{if(typeof c.attachEvent!="undefined"){c.attachEvent("on"+b,d)}else{gadgets.warn("cannot attachBrowserEvent: "+b)}}};gadgets.util.removeBrowserEvent=function(c,b,d,a){if(c.removeEventListener){c.removeEventListener(b,d,a)}else{if(c.detachEvent){c.detachEvent("on"+b,d)}else{gadgets.warn("cannot removeBrowserEvent: "+b)}}};gadgets.util=gadgets.util||{};(function(){var a=[];gadgets.util.registerOnLoadHandler=function(b){a.push(b)};gadgets.util.runOnLoadHandlers=function(){gadgets.util.registerOnLoadHandler=function(e){e()};for(var d=0,b=a.length;d<b;++d){try{a[d]()}catch(c){gadgets.warn("Could not fire onloadhandler "+c.message)}}a=undefined}})();tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.util,"registerOnLoadHandler"]])});gadgets.util=gadgets.util||{};(function(){var a={0:false,10:true,13:true,34:true,39:true,60:true,62:true,92:true,8232:true,8233:true,65282:true,65287:true,65308:true,65310:true,65340:true};function b(c,d){return String.fromCharCode(d)}gadgets.util.escape=function(c,g){if(!c){return c}else{if(typeof c==="string"){return gadgets.util.escapeString(c)}else{if(typeof c==="array"){for(var f=0,d=c.length;f<d;++f){c[f]=gadgets.util.escape(c[f])}}else{if(typeof c==="object"&&g){var e={};for(var h in c){if(c.hasOwnProperty(h)){e[gadgets.util.escapeString(h)]=gadgets.util.escape(c[h],true)}}return e}}}}return c};gadgets.util.escapeString=function(g){if(!g){return g}var d=[],f,h;for(var e=0,c=g.length;e<c;++e){f=g.charCodeAt(e);h=a[f];if(h===true){d.push("&#",f,";")}else{if(h!==false){d.push(g.charAt(e))}}}return d.join("")};gadgets.util.unescapeString=function(c){if(!c){return c}return c.replace(/&#([0-9]+);/g,b)}})();tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.util,"escape"],[gadgets.util,"escapeString"],[gadgets.util,"unescapeString"]])});gadgets.util=gadgets.util||{};(function(){var a=null;function b(e){var f;var c=e.indexOf("?");var d=e.indexOf("#");if(d===-1){f=e.substr(c+1)}else{f=[e.substr(c+1,d-c-1),"&",e.substr(d+1)].join("")}return f.split("&")}gadgets.util.getUrlParameters=function(p){var d=typeof p==="undefined";if(a!==null&&d){return a}var l={};var f=b(p||document.location.href);var n=window.decodeURIComponent?decodeURIComponent:unescape;for(var h=0,g=f.length;h<g;++h){var m=f[h].indexOf("=");if(m===-1){continue}var c=f[h].substring(0,m);var o=f[h].substring(m+1);o=o.replace(/\+/g," ");try{l[c]=n(o)}catch(k){}}if(d){a=l}return l}})();gadgets.util.getUrlParameters();tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.util,"getUrlParameters"]])});gadgets.util=gadgets.util||{};(function(){var b={};var a={};function c(d){b=d["core.util"]||{}}if(gadgets.config){gadgets.config.register("core.util",null,c)}gadgets.util.getFeatureParameters=function(d){return typeof b[d]==="undefined"?null:b[d]};gadgets.util.hasFeature=function(d){return typeof b[d]!=="undefined"};gadgets.util.getServices=function(){return a}})();tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.util,"getFeatureParameters"],[gadgets.util,"hasFeature"]])});shindig.Auth=function(){var authToken=null;var trusted=null;function addParamsToToken(urlParams){var args=authToken.split("&");for(var i=0;i<args.length;i++){var nameAndValue=args[i].split("=");if(nameAndValue.length===2){var name=nameAndValue[0];var value=nameAndValue[1];if(value==="$"){value=encodeURIComponent(urlParams[name]);args[i]=name+"="+value}}}authToken=args.join("&")}function init(configuration){var urlParams=gadgets.util.getUrlParameters();var config=configuration["shindig.auth"]||{};if(config.authToken){authToken=config.authToken}else{if(urlParams.st){authToken=urlParams.st}}if(authToken!==null){addParamsToToken(urlParams)}if(config.trustedJson){trusted=eval("("+config.trustedJson+")")}}gadgets.config.register("shindig.auth",null,init);return{getSecurityToken:function(){return authToken},updateSecurityToken:function(newToken){authToken=newToken},getTrustedData:function(){return trusted}}};shindig.auth=new shindig.Auth();if(window.JSON&&window.JSON.parse&&window.JSON.stringify){gadgets.json=(function(){var a=/___$/;function b(d,e){var c=this[d];return c}return{parse:function(d){try{return window.JSON.parse(d)}catch(c){return false}},stringify:function(d){var h=window.JSON.stringify;function f(e){return h.call(this,e,b)}var g=(Array.prototype.toJSON&&h([{x:1}])==='"[{\\"x\\": 1}]"')?f:h;try{return g(d,function(i,e){return !a.test(i)?e:void 0})}catch(c){return null}}}})()}if(!(window.JSON&&window.JSON.parse&&window.JSON.stringify)){gadgets.json=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("")};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value){var a,i,k,l,r=/[\"\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}a=[];if(typeof value.length==="number"&&!value.propertyIsEnumerable("length")){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i])||"null")}return"["+a.join(",")+"]"}for(k in value){if(/___$/.test(k)){continue}if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}return""}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}return false}}}()}gadgets.json.flatten=function(c){var d={};if(c===null||typeof c=="undefined"){return d}for(var a in c){if(c.hasOwnProperty(a)){var b=c[a];if(null===b||typeof b=="undefined"){continue}d[a]=(typeof b==="string")?b:gadgets.json.stringify(b)}}return d};gadgets.io=function(){var ioTransactionId=0;var ajaxPollQ={};var config={};var oauthState;function makeXhr(){var x;if(typeof shindig!="undefined"&&shindig.xhrwrapper&&shindig.xhrwrapper.createXHR){return shindig.xhrwrapper.createXHR()}else{if(typeof ActiveXObject!="undefined"){try{x=new ActiveXObject("Msxml2.XMLHTTP");if(!x){x=new ActiveXObject("Microsoft.XMLHTTP")}return x}catch(e){}}}if(typeof XMLHttpRequest!="undefined"||window.XMLHttpRequest){return new window.XMLHttpRequest()}else{throw ("no xhr available")}}function hadError(xobj,callback){if(xobj.readyState!==4){return true}try{if(xobj.status!==200){var error=(""+xobj.status);if(xobj.responseText){error=error+" "+xobj.responseText}callback({errors:[error],rc:xobj.status,text:xobj.responseText});return true}}catch(e){callback({errors:[e.number+" Error not specified"],rc:e.number,text:e.description});return true}return false}function processNonProxiedResponse(url,callback,params,xobj){if(hadError(xobj,callback)){return}var data={body:xobj.responseText};callback(transformResponseData(params,data))}function processResponse(url,callback,params,xobj){if(hadError(xobj,callback)){return}var txt=xobj.responseText;var UNPARSEABLE_CRUFT=config.unparseableCruft;var offset=txt.indexOf(UNPARSEABLE_CRUFT)+UNPARSEABLE_CRUFT.length;if(offset<UNPARSEABLE_CRUFT.length){return}txt=txt.substr(offset);var data=eval("("+txt+")");data=data[url];if(data.oauthState){oauthState=data.oauthState}if(data.st){shindig.auth.updateSecurityToken(data.st)}callback(transformResponseData(params,data))}function transformResponseData(params,data){var resp={text:data.body,rc:data.rc||200,headers:data.headers,oauthApprovalUrl:data.oauthApprovalUrl,oauthError:data.oauthError,oauthErrorText:data.oauthErrorText,oauthErrorTrace:data.oauthErrorTrace,oauthErrorUri:data.oauthErrorUri,oauthErrorExplanation:data.oauthErrorExplanation,errors:[]};if(resp.rc<200||resp.rc>=400){resp.errors=[resp.rc+" Error"]}else{if(resp.text){if(resp.rc>=300&&resp.rc<400){params.CONTENT_TYPE="TEXT"}switch(params.CONTENT_TYPE){case"JSON":case"FEED":resp.data=gadgets.json.parse(resp.text);if(!resp.data){resp.errors.push("500 Failed to parse JSON");resp.rc=500;resp.data=null}break;case"DOM":var dom;if(typeof DOMParser!="undefined"){var parser=new DOMParser();dom=parser.parseFromString(resp.text,"text/xml");if("parsererror"===dom.documentElement.nodeName){resp.errors.push("500 Failed to parse XML");resp.rc=500}else{resp.data=dom}}else{if(typeof ActiveXObject!="undefined"){dom=new ActiveXObject("Microsoft.XMLDOM");dom.async=false;dom.validateOnParse=false;dom.resolveExternals=false;if(!dom.loadXML(resp.text)){resp.errors.push("500 Failed to parse XML");resp.rc=500}else{resp.data=dom}}else{resp.errors.push("500 Failed to parse XML because no DOM parser was available");resp.rc=500}}break;default:resp.data=resp.text;break}}}return resp}function makeXhrRequest(realUrl,proxyUrl,callback,paramData,method,params,processResponseFunction,opt_headers){var xhr=makeXhr();if(proxyUrl.indexOf("//")==0){proxyUrl=document.location.protocol+proxyUrl}xhr.open(method,proxyUrl,true);if(callback){var closureCallback=gadgets.util.makeClosure(null,processResponseFunction,realUrl,callback,params,xhr);var shouldPoll=gadgets.util.shouldPollXhrReadyStateChange();if(shouldPoll){handleReadyState(xhr,closureCallback)}else{xhr.onreadystatechange=closureCallback}}if(typeof opt_headers==="string"){contentType=opt_headers;opt_headers={}}var headers=opt_headers||{};if(paramData!==null){var contentTypeHeader="Content-Type";var contentType="application/x-www-form-urlencoded";if(!headers[contentTypeHeader]){headers[contentTypeHeader]=contentType}}for(var headerName in headers){xhr.setRequestHeader(headerName,headers[headerName])}xhr.send(paramData)}function handleReadyState(xhr,callback){var tempTid=ioTransactionId;var pollInterval=config.xhrPollIntervalMs||50;ajaxPollQ[tempTid]=window.setInterval(function(){if(xhr&&xhr.readyState===4){window.clearInterval(ajaxPollQ[tempTid]);delete ajaxPollQ[tempTid];if(callback){callback()}}},pollInterval);ioTransactionId++}function respondWithPreload(postData,params,callback){if(gadgets.io.preloaded_&&postData.httpMethod==="GET"){for(var i=0;i<gadgets.io.preloaded_.length;i++){var preload=gadgets.io.preloaded_[i];if(preload&&(preload.id===postData.url)){delete gadgets.io.preloaded_[i];if(preload.rc!==200){callback({rc:preload.rc,errors:[preload.rc+" Error"]})}else{if(preload.oauthState){oauthState=preload.oauthState}var resp={body:preload.body,rc:preload.rc,headers:preload.headers,oauthApprovalUrl:preload.oauthApprovalUrl,oauthError:preload.oauthError,oauthErrorText:preload.oauthErrorText,oauthErrorTrace:preload.oauthErrorTrace,oauthErrorUri:preload.oauthErrorUri,oauthErrorExplanation:preload.oauthErrorExplanation,errors:[]};callback(transformResponseData(params,resp))}return true}}}return false}function init(configuration){config=configuration["core.io"]||{}}gadgets.config.register("core.io",null,init);return{makeRequest:function(url,callback,opt_params){var params=opt_params||{};var httpMethod=params.METHOD||"GET";var refreshInterval=params.REFRESH_INTERVAL;var auth,st;if(params.AUTHORIZATION&&params.AUTHORIZATION!=="NONE"){auth=params.AUTHORIZATION.toLowerCase();st=shindig.auth.getSecurityToken()}var signOwner=true;if(typeof params.SIGN_OWNER!=="undefined"){signOwner=params.SIGN_OWNER}var signViewer=true;if(typeof params.SIGN_VIEWER!=="undefined"){signViewer=params.SIGN_VIEWER}var headers=params.HEADERS||{};if(httpMethod==="POST"&&!headers["Content-Type"]){headers["Content-Type"]="application/x-www-form-urlencoded"}var urlParams=gadgets.util.getUrlParameters();var paramData={url:url,httpMethod:httpMethod,headers:gadgets.io.encodeValues(headers,false),postData:params.POST_DATA||"",authz:auth||"",st:st||"",contentType:params.CONTENT_TYPE||"TEXT",numEntries:params.NUM_ENTRIES||"3",getSummaries:!!params.GET_SUMMARIES,signOwner:signOwner,signViewer:signViewer,gadget:urlParams.url,container:urlParams.container||urlParams.synd||"default",bypassSpecCache:gadgets.util.getUrlParameters()["nocache"]||"",getFullHeaders:!!params.GET_FULL_HEADERS};if(auth==="oauth"||auth==="signed"||auth==="oauth2"){if(gadgets.io.oauthReceivedCallbackUrl_){paramData.OAUTH_RECEIVED_CALLBACK=gadgets.io.oauthReceivedCallbackUrl_;gadgets.io.oauthReceivedCallbackUrl_=null}paramData.oauthState=oauthState||"";for(var opt in params){if(params.hasOwnProperty(opt)){if(opt.indexOf("OAUTH_")===0||opt==="code"){paramData[opt]=params[opt]}}}}st=st||shindig.auth.getSecurityToken();var opt_headers=st?{"X-Shindig-ST":st}:{};var proxyUrl=config.jsonProxyUrl.replace("%host%",document.location.host);if(!respondWithPreload(paramData,params,callback)){if(httpMethod=="GET"&&typeof(refreshInterval)!="undefined"){paramData.refresh=refreshInterval}if(httpMethod==="GET"&&!paramData.authz){var extraparams="?"+gadgets.io.encodeValues(paramData);makeXhrRequest(url,proxyUrl+extraparams,callback,null,"GET",params,processResponse,opt_headers)}else{var extraparams=gadgets.io.encodeValues(paramData);makeXhrRequest(url,proxyUrl,callback,extraparams,"POST",params,processResponse,opt_headers)}}},makeNonProxiedRequest:function(relativeUrl,callback,opt_params,opt_headers){var params=opt_params||{};makeXhrRequest(relativeUrl,relativeUrl,callback,params.POST_DATA,params.METHOD,params,processNonProxiedResponse,opt_headers)},clearOAuthState:function(){oauthState=undefined},encodeValues:function(fields,opt_noEscaping){var escape=!opt_noEscaping;var buf=[];var first=false;for(var i in fields){if(fields.hasOwnProperty(i)&&!/___$/.test(i)){if(!first){first=true}else{buf.push("&")}buf.push(escape?encodeURIComponent(i):i);buf.push("=");buf.push(escape?encodeURIComponent(fields[i]):fields[i])}}return buf.join("")},getProxyUrl:function(url,opt_params){var proxyUrl=config.proxyUrl;if(!proxyUrl){return proxyUrl}var params=opt_params||{};var refresh=params.REFRESH_INTERVAL;if(typeof refresh=="undefined"){refresh="3600"}var urlParams=gadgets.util.getUrlParameters();var st=shindig.auth.getSecurityToken();var authz=params[gadgets.io.RequestParameters.AUTHORIZATION];var serviceName=params[gadgets.io.RequestParameters.OAUTH_SERVICE_NAME];var rewriteMimeParam=params.rewriteMime?"&rewriteMime="+encodeURIComponent(params.rewriteMime):"";var authParam="";if(authz){if(authz==gadgets.io.AuthorizationType.OAUTH||authz==gadgets.io.AuthorizationType.OAUTH2){authParam="&authz="+authz.toLowerCase()+"&st="+encodeURIComponent(st)+"&OAUTH_SERVICE_NAME="+encodeURIComponent(serviceName)}else{authParam="&authz="+authz.toLowerCase()}}var ret=proxyUrl.replace("%url%",encodeURIComponent(url)).replace("%host%",document.location.host).replace("%rawurl%",url).replace("%refresh%",encodeURIComponent(refresh)).replace("%gadget%",encodeURIComponent(urlParams.url)).replace("%container%",encodeURIComponent(urlParams.container||urlParams.synd||"default")).replace("%authz%",authParam).replace("%rewriteMime%",rewriteMimeParam);if(ret.indexOf("//")==0){ret=window.location.protocol+ret}return ret},processResponse_:processResponse}}();gadgets.io.RequestParameters=gadgets.util.makeEnum(["METHOD","CONTENT_TYPE","POST_DATA","HEADERS","AUTHORIZATION","NUM_ENTRIES","GET_SUMMARIES","GET_FULL_HEADERS","REFRESH_INTERVAL","SIGN_OWNER","SIGN_VIEWER","OAUTH_SERVICE_NAME","OAUTH_USE_TOKEN","OAUTH_TOKEN_NAME","OAUTH_REQUEST_TOKEN","OAUTH_REQUEST_TOKEN_SECRET","OAUTH_RECEIVED_CALLBACK"]);gadgets.io.MethodType=gadgets.util.makeEnum(["GET","POST","PUT","DELETE","HEAD"]);gadgets.io.ContentType=gadgets.util.makeEnum(["TEXT","DOM","JSON","FEED"]);gadgets.io.AuthorizationType=gadgets.util.makeEnum(["NONE","SIGNED","OAUTH","OAUTH2"]);tamings___.push(function(a){caja___.whitelistFuncs([[gadgets.io,"encodeValues"],[gadgets.io,"getProxyUrl"],[gadgets.io,"makeRequest"]])});gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.wpm){gadgets.rpctx.wpm=function(){var e,d;var c=true;function b(h,i,g){if(typeof window.addEventListener!="undefined"){window.addEventListener(h,i,g)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("on"+h,i)}}}function a(h,i,g){if(window.removeEventListener){window.removeEventListener(h,i,g)}else{if(window.detachEvent){window.detachEvent("on"+h,i)}}}function f(h){var i=gadgets.json.parse(h.data);if(!i||!i.f){return}var g=gadgets.rpc.getTargetOrigin(i.f);if(c&&(typeof h.origin!=="undefined"?h.origin!==g:h.domain!==/^.+:\/\/([^:]+).*/.exec(g)[1])){return}e(i,h.origin)}return{getCode:function(){return"wpm"},isParentVerifiable:function(){return true},init:function(h,i){function g(k){var j=k?k.rpc:{};if(String(j.disableForceSecure)==="true"){c=false}}gadgets.config.register("rpc",null,g);e=h;d=i;b("message",f,false);d("..",true);return true},setup:function(h,g){d(h,true);return true},call:function(h,k,j){var g=gadgets.rpc.getTargetOrigin(h);var i=gadgets.rpc._getTargetWin(h);if(g){window.setTimeout(function(){i.postMessage(gadgets.json.stringify(j),g)},0)}else{gadgets.error("No relay set (used as window.postMessage targetOrigin), cannot send cross-domain message")}return true}}}()}gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.flash){gadgets.rpctx.flash=function(){var B="___xpcswf";var s=null;var k=false;var l=null;var I=null;var w=null;var J=100;var t=50;var C=[];var b=null;var o=500;var K=null;var a=0;var x="_scr";var g="_pnt";var j=100;var r=50;var n=0;var f=null;var A={};var E=window.location.protocol+"//"+window.location.host;var p="___jsl";var e="_fm";var i;function v(){window[p]=window[p]||{};var M=window[p];var N=M[e]={};i=p+"."+e;return N}var m=v();function L(O,M){var N=function(){O.apply({},arguments)};m[M]=m[M]||N;return i+"."+M}function q(M){return M===".."?gadgets.rpc.RPC_ID:M}function F(M){return M===".."?"INNER":"OUTER"}function H(M){if(k){s=M.rpc["commSwf"]||"//xpc.googleusercontent.com/gadgets/xpc.swf"}}gadgets.config.register("rpc",null,H);function y(){if(w===null&&document.body&&s){var O=s+"?cb="+Math.random()+"&origin="+E+"&jsl=1";var N=document.createElement("div");N.style.height="1px";N.style.width="1px";var M='<object height="1" width="1" id="'+B+'" type="application/x-shockwave-flash"><param name="allowScriptAccess" value="always"></param><param name="movie" value="'+O+'"></param><embed type="application/x-shockwave-flash" allowScriptAccess="always" src="'+O+'" height="1" width="1"></embed></object>';document.body.appendChild(N);N.innerHTML=M;w=N.firstChild}++a;if(K!==null&&(w!==null||a>=t)){window.clearTimeout(K)}else{K=window.setTimeout(y,J)}}function D(){if(A[".."]){return}z("..");n++;if(n>=r&&f!==null){window.clearTimeout(f);f=null}else{f=window.setTimeout(D,j)}}function G(){if(w!==null&&w.setup){while(C.length>0){var N=C.shift();var M=N.targetId;w.setup(N.token,q(M),F(M))}if(b!==null){window.clearTimeout(b);b=null}}else{if(b===null&&C.length>0){b=window.setTimeout(G,o)}}}function h(){G();if(K!==null){window.clearTimeout(K)}K=null}L(h,"ready");function c(){if(!A[".."]&&f===null){f=window.setTimeout(D,j)}}L(c,"setupDone");function d(O,S,Q){var N=gadgets.rpc.getTargetOrigin(O);var R=gadgets.rpc.getAuthToken(O);var M="sendMessage_"+q(O)+"_"+R+"_"+F(O);var P=w[M];P.call(w,gadgets.json.stringify(Q),N);return true}function u(O,Q,P){var M=gadgets.json.parse(O);var N=M[x];if(N){I(N,true);A[N]=true;if(N!==".."){z(N,true)}return}window.setTimeout(function(){l(M,Q)},0)}L(u,"receiveMessage");function z(P,O){var M=gadgets.rpc.RPC_ID;var N={};N[x]=O?"..":M;N[g]=M;d(P,M,N)}return{getCode:function(){return"flash"},isParentVerifiable:function(){return true},init:function(N,M){l=N;I=M;k=true;return true},setup:function(N,M){C.push({token:M,targetId:N});if(w===null&&K===null){K=window.setTimeout(y,J)}G();return true},call:d,_receiveMessage:u,_ready:h,_setupDone:c}}()}gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.frameElement){gadgets.rpctx.frameElement=function(){var e="__g2c_rpc";var b="__c2g_rpc";var d;var c;function a(g,k,j){try{if(k!==".."){var f=window.frameElement;if(typeof f[e]==="function"){if(typeof f[e][b]!=="function"){f[e][b]=function(l){d(gadgets.json.parse(l))}}f[e](gadgets.json.stringify(j));return true}}else{var i=document.getElementById(g);if(typeof i[e]==="function"&&typeof i[e][b]==="function"){i[e][b](gadgets.json.stringify(j));return true}}}catch(h){}return false}return{getCode:function(){return"fe"},isParentVerifiable:function(){return false},init:function(f,g){d=f;c=g;return true},setup:function(j,f){if(j!==".."){try{var i=document.getElementById(j);i[e]=function(k){d(gadgets.json.parse(k))}}catch(h){return false}}if(j===".."){c("..",true);var g=function(){window.setTimeout(function(){gadgets.rpc.call(j,gadgets.rpc.ACK)},500)};gadgets.util.registerOnLoadHandler(g)}return true},call:function(f,h,g){return a(f,h,g)}}}()}gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.nix){gadgets.rpctx.nix=function(){var c="GRPC____NIXVBS_wrapper";var d="GRPC____NIXVBS_get_wrapper";var f="GRPC____NIXVBS_handle_message";var b="GRPC____NIXVBS_create_channel";var a=10;var j=500;var i={};var h;var g=0;function e(){var l=i[".."];if(l){return}if(++g>a){gadgets.warn("Nix transport setup failed, falling back...");h("..",false);return}if(!l&&window.opener&&"GetAuthToken" in window.opener){l=window.opener;if(l.GetAuthToken()==gadgets.rpc.getAuthToken("..")){var k=gadgets.rpc.getAuthToken("..");l.CreateChannel(window[d]("..",k),k);i[".."]=l;window.opener=null;h("..",true);return}}window.setTimeout(function(){e()},j)}return{getCode:function(){return"nix"},isParentVerifiable:function(){return false},init:function(l,m){h=m;if(typeof window[d]!=="unknown"){window[f]=function(o){window.setTimeout(function(){l(gadgets.json.parse(o))},0)};window[b]=function(o,q,p){if(gadgets.rpc.getAuthToken(o)===p){i[o]=q;h(o,true)}};var k="Class "+c+"\n Private m_Intended\nPrivate m_Auth\nPublic Sub SetIntendedName(name)\n If isEmpty(m_Intended) Then\nm_Intended = name\nEnd If\nEnd Sub\nPublic Sub SetAuth(auth)\n If isEmpty(m_Auth) Then\nm_Auth = auth\nEnd If\nEnd Sub\nPublic Sub SendMessage(data)\n "+f+"(data)\nEnd Sub\nPublic Function GetAuthToken()\n GetAuthToken = m_Auth\nEnd Function\nPublic Sub CreateChannel(channel, auth)\n Call "+b+"(m_Intended, channel, auth)\nEnd Sub\nEnd Class\nFunction "+d+"(name, auth)\nDim wrap\nSet wrap = New "+c+"\nwrap.SetIntendedName name\nwrap.SetAuth auth\nSet "+d+" = wrap\nEnd Function";try{window.execScript(k,"vbscript")}catch(n){return false}}return true},setup:function(o,k){if(o===".."){e();return true}try{var m=document.getElementById(o);var n=window[d](o,k);m.contentWindow.opener=n}catch(l){return false}return true},call:function(k,n,m){try{if(i[k]){i[k].SendMessage(gadgets.json.stringify(m))}}catch(l){return false}return true}}}()}gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.rmr){gadgets.rpctx.rmr=function(){var h=500;var f=10;var i={};var a=gadgets.util.getUrlParameters()["parent"];var c;var j;function l(q,o,p,n){var r=function(){document.body.appendChild(q);q.src="about:blank";if(n){q.onload=function(){m(n)}}q.src=o+"#"+p};if(document.body){r()}else{gadgets.util.registerOnLoadHandler(function(){r()})}}function d(q){if(typeof i[q]==="object"){return}var r=document.createElement("iframe");var o=r.style;o.position="absolute";o.top="0px";o.border="0";o.opacity="0";o.width="10px";o.height="1px";r.id="rmrtransport-"+q;r.name=r.id;var p=gadgets.rpc.getRelayUrl(q);var n=gadgets.rpc.getOrigin(a);if(!p){p=n+"/robots.txt"}i[q]={frame:r,receiveWindow:null,relayUri:p,relayOrigin:n,searchCounter:0,width:10,waiting:true,queue:[],sendId:0,recvId:0,verifySendToken:String(Math.random()),verifyRecvToken:null,originVerified:false};if(q!==".."){l(r,p,b(q))}e(q)}function e(p){var r=null;i[p].searchCounter++;try{var o=gadgets.rpc._getTargetWin(p);if(p===".."){r=o.frames["rmrtransport-"+gadgets.rpc.RPC_ID]}else{r=o.frames["rmrtransport-.."]}}catch(q){}var n=false;if(r){n=g(p,r)}if(!n){if(i[p].searchCounter>f){return}window.setTimeout(function(){e(p)},h)}}function k(o,q,u,t){var p=null;if(u!==".."){p=i[".."]}else{p=i[o]}if(p){if(q!==gadgets.rpc.ACK){p.queue.push(t)}if(p.waiting||(p.queue.length===0&&!(q===gadgets.rpc.ACK&&t&&t.ackAlone===true))){return true}if(p.queue.length>0){p.waiting=true}var n=p.relayUri+"#"+b(o);try{p.frame.contentWindow.location=n;var r=p.width==10?20:10;p.frame.style.width=r+"px";p.width=r}catch(s){return false}}return true}function b(o){var p=i[o];var n={id:p.sendId};if(p){n.d=Array.prototype.slice.call(p.queue,0);var q={s:gadgets.rpc.ACK,id:p.recvId};if(!p.originVerified){q.sendToken=p.verifySendToken}if(p.verifyRecvToken){q.recvToken=p.verifyRecvToken}n.d.push(q)}return gadgets.json.stringify(n)}function m(y){var v=i[y];var r=v.receiveWindow.location.hash.substring(1);var z=gadgets.json.parse(decodeURIComponent(r))||{};var o=z.d||[];var p=false;var u=false;var w=0;var n=(v.recvId-z.id);for(var q=0;q<o.length;++q){var t=o[q];if(t.s===gadgets.rpc.ACK){j(y,true);v.verifyRecvToken=t.sendToken;if(!v.originVerified&&t.recvToken&&String(t.recvToken)==String(v.verifySendToken)){v.originVerified=true}if(v.waiting){u=true}v.waiting=false;var s=Math.max(0,t.id-v.sendId);v.queue.splice(0,s);v.sendId=Math.max(v.sendId,t.id||0);continue}p=true;if(++w<=n){continue}++v.recvId;c(t,v.originVerified?v.relayOrigin:undefined)}if(p||(u&&v.queue.length>0)){var x=(y==="..")?gadgets.rpc.RPC_ID:"..";k(y,gadgets.rpc.ACK,x,{ackAlone:p})}}function g(q,t){var p=i[q];try{var o=false;o="document" in t;if(!o){return false}o=typeof t.document=="object";if(!o){return false}var s=t.location.href;if(s==="about:blank"){return false}}catch(n){return false}p.receiveWindow=t;function r(){m(q)}if(typeof t.attachEvent==="undefined"){t.onresize=r}else{t.attachEvent("onresize",r)}if(q===".."){l(p.frame,p.relayUri,b(q),q)}else{m(q)}return true}return{getCode:function(){return"rmr"},isParentVerifiable:function(){return true},init:function(n,o){c=n;j=o;return true},setup:function(p,n){try{d(p)}catch(o){gadgets.warn("Caught exception setting up RMR: "+o);return false}return true},call:function(n,p,o){return k(n,o.s,p,o)}}}()}gadgets.rpctx=gadgets.rpctx||{};if(!gadgets.rpctx.ifpc){gadgets.rpctx.ifpc=function(){var h=[];var e=0;var d;var a=2000;var g={};function c(m){var k=[];for(var n=0,l=m.length;n<l;++n){k.push(encodeURIComponent(gadgets.json.stringify(m[n])))}return k.join("&")}function b(m){var k;for(var j=h.length-1;j>=0;--j){var n=h[j];try{if(n&&(n.recyclable||n.readyState==="complete")){n.parentNode.removeChild(n);if(window.ActiveXObject){h[j]=n=null;h.splice(j,1)}else{n.recyclable=false;k=n;break}}}catch(l){}}if(!k){k=document.createElement("iframe");k.style.border=k.style.width=k.style.height="0px";k.style.visibility="hidden";k.style.position="absolute";k.onload=function(){this.recyclable=true};h.push(k)}k.src=m;window.setTimeout(function(){document.body.appendChild(k)},0)}function f(j,l){for(var k=l-1;k>=0;--k){if(typeof j[k]==="undefined"){return false}}return true}return{getCode:function(){return"ifpc"},isParentVerifiable:function(){return true},init:function(i,j){d=j;d("..",true);return true},setup:function(j,i){d(j,true);return true},call:function(s,r,q){var l=gadgets.rpc.getRelayUrl(s);++e;if(!l){gadgets.warn("No relay file assigned for IFPC");return false}var i=null,j=[];if(q.l){var o=q.a;i=[l,"#",c([r,e,1,0,c([r,q.s,"","",r].concat(o))])].join("");j.push(i)}else{i=[l,"#",s,"&",r,"@",e,"&"].join("");var t=encodeURIComponent(gadgets.json.stringify(q)),n=a-i.length,p=Math.ceil(t.length/n),m=0,k;while(t.length>0){k=t.substring(0,n);t=t.substring(n);j.push([i,p,"&",m,"&",k].join(""));m+=1}}do{b(j.shift())}while(j.length>0);return true},_receiveMessage:function(i,n){var o=i[1],m=parseInt(i[2],10),k=parseInt(i[3],10),l=i[i.length-1],j=m===1;if(m>1){if(!g[o]){g[o]=[]}g[o][k]=l;if(f(g[o],m)){l=g[o].join("");delete g[o];j=true}}if(j){n(gadgets.json.parse(decodeURIComponent(l)))}}}}()}if(!window.gadgets["rpc"]){gadgets.rpc=function(){var M="__cb";var V="";var W="__ack";var f=500;var G=10;var b="|";var u="callback";var g="origin";var s="referer";var q={};var Z={};var D={};var B={};var z=0;var l={};var m={};var T={};var d={};var n={};var E={};var e=null;var p=null;var A=!!gadgets.util.getUrlParameters().parent&&(window.top!==window.self);var v=window.name;var J=function(){};var r=null;var Q=0;var ab=1;var a=2;var x=window.console;var Y=x&&x.log?function(ah){x.log(ah)}:function(){};var U=(function(){function ah(ai){return function(){Y(ai+": call ignored")}}return{getCode:function(){return"noop"},isParentVerifiable:function(){return true},init:ah("init"),setup:ah("setup"),call:ah("call")}})();if(gadgets.util){d=gadgets.util.getUrlParameters()}function K(){if(d.rpctx=="flash"){return gadgets.rpctx.flash}if(d.rpctx=="rmr"){return gadgets.rpctx.rmr}return typeof window.postMessage==="function"?gadgets.rpctx.wpm:typeof window.postMessage==="object"?gadgets.rpctx.wpm:window.ActiveXObject?(gadgets.rpctx.flash?gadgets.rpctx.flash:gadgets.rpctx.nix):navigator.userAgent.indexOf("WebKit")>0?gadgets.rpctx.rmr:navigator.product==="Gecko"?gadgets.rpctx.frameElement:gadgets.rpctx.ifpc}function k(am,ak){if(n[am]){return}var ai=H;if(!ak){ai=U}n[am]=ai;var ah=E[am]||[];for(var aj=0;aj<ah.length;++aj){var al=ah[aj];al.t=F(am);ai.call(am,al.f,al)}E[am]=[]}var I=false,X=false;function O(){if(X){return}function ah(){I=true}if(typeof window.addEventListener!="undefined"){window.addEventListener("unload",ah,false)}else{if(typeof window.attachEvent!="undefined"){window.attachEvent("onunload",ah)}}X=true}function j(ah,al,ai,ak,aj){if(!B[al]||B[al]!==ai){gadgets.error("Invalid auth token. "+B[al]+" vs "+ai);J(al,a)}aj.onunload=function(){if(m[al]&&!I){J(al,ab);gadgets.rpc.removeReceiver(al)}};O();ak=gadgets.json.parse(decodeURIComponent(ak))}function ac(al,ai){if(al&&typeof al.s==="string"&&typeof al.f==="string"&&al.a instanceof Array){if(typeof arbitrate==="function"&&!arbitrate(al.s,al.f)){return}if(B[al.f]){if(B[al.f]!==al.t){gadgets.error("Invalid auth token. "+B[al.f]+" vs "+al.t);J(al.f,a)}}if(al.s===W){window.setTimeout(function(){k(al.f,true)},0);return}if(al.c){al[u]=function(am){gadgets.rpc.call(al.f,M,null,al.c,am)}}if(ai){var aj=t(ai);al[g]=ai;var ak=al.r;if(!ak||t(ak)!=aj){ak=ai}al[s]=ak}var ah=(q[al.s]||q[V]).apply(al,al.a);if(al.c&&typeof ah!=="undefined"){gadgets.rpc.call(al.f,M,null,al.c,ah)}}}function t(aj){if(!aj){return""}aj=aj.toLowerCase();if(aj.indexOf("//")==0){aj=window.location.protocol+aj}if(aj.indexOf("://")==-1){aj=window.location.protocol+"//"+aj}var ak=aj.substring(aj.indexOf("://")+3);var ah=ak.indexOf("/");if(ah!=-1){ak=ak.substring(0,ah)}var am=aj.substring(0,aj.indexOf("://"));var al="";var an=ak.indexOf(":");if(an!=-1){var ai=ak.substring(an+1);ak=ak.substring(0,an);if((am==="http"&&ai!=="80")||(am==="https"&&ai!=="443")){al=":"+ai}}return am+"://"+ak+al}function C(ai,ah){return"/"+ai+(ah?b+ah:"")}function y(ak){if(ak.charAt(0)=="/"){var ai=ak.indexOf(b);var aj=ai>0?ak.substring(1,ai):ak.substring(1);var ah=ai>0?ak.substring(ai+1):null;return{id:aj,origin:ah}}else{return null}}function ag(aj){if(typeof aj==="undefined"||aj===".."){return window.parent}var ai=y(aj);if(ai){return window.frames[ai.id]}aj=String(aj);var ah=document.getElementById(aj);if(ah&&ah.contentWindow){return ah.contentWindow}ah=window.frames[aj];if(ah&&!ah.closed){return ah}return null}function L(ak){var aj=null;var ah=P(ak);if(ah){aj=ah}else{var ai=y(ak);if(ai){aj=ai.origin}else{if(ak==".."){aj=d.parent}else{aj=document.getElementById(ak).src}}}return t(aj)}var H=K();q[V]=function(){Y("Unknown RPC service: "+this.s)};q[M]=function(ai,ah){var aj=l[ai];if(aj){delete l[ai];aj.call(this,ah)}};function aa(aj,ah){if(m[aj]===true){return}if(typeof m[aj]==="undefined"){m[aj]=0}var ai=ag(aj);if(aj===".."||ai!=null){if(H.setup(aj,ah)===true){m[aj]=true;return}}if(m[aj]!==true&&m[aj]++<G){window.setTimeout(function(){aa(aj,ah)},f)}else{n[aj]=U;m[aj]=true}}var S={};function N(ai,al){var ak=ag(ai);if(!T[ai]||(T[ai]!==S&&ak.Function.prototype!==T[ai].constructor.prototype)){var aj=P(ai);if(t(aj)!==t(window.location.href)){T[ai]=S;return false}try{var am=ak.gadgets;T[ai]=am.rpc.receiveSameDomain}catch(ah){T[ai]=S;return false}}if(T[ai]&&T[ai]!==S){T[ai](al);return true}return false}function P(ai){var ah=Z[ai];if(ah&&ah.substring(0,1)==="/"){if(ah.substring(1,2)==="/"){ah=document.location.protocol+ah}else{ah=document.location.protocol+"//"+document.location.host+ah}}return ah}function af(ai,ah,aj){if(!/http(s)?:\/\/.+/.test(ah)){if(ah.indexOf("//")==0){ah=window.location.protocol+ah}else{if(ah.charAt(0)=="/"){ah=window.location.protocol+"//"+window.location.host+ah}else{if(ah.indexOf("://")==-1){ah=window.location.protocol+"//"+ah}}}}Z[ai]=ah;if(typeof aj!=="undefined"){D[ai]=!!aj}}function F(ah){return B[ah]}function c(ah,ai){ai=ai||"";B[ah]=String(ai);aa(ah,ai)}function ae(ai){var ah=ai.passReferrer||"";var aj=ah.split(":",2);e=aj[0]||"none";p=aj[1]||"origin"}function ad(ah){if(R(ah)){H=gadgets.rpctx.ifpc;H.init(ac,k)}}function R(ah){return String(ah.useLegacyProtocol)==="true"}function h(ai,ah){function aj(am){var al=am?am.rpc:{};ae(al);var ak=al.parentRelayUrl||"";ak=t(d.parent||ah)+ak;af("..",ak,R(al));ad(al);c("..",ai)}if(!d.parent&&ah){aj({});return}gadgets.config.register("rpc",null,aj)}function o(ai,am,ao){var al=null;if(ai.charAt(0)!="/"){if(!gadgets.util){return}al=document.getElementById(ai);if(!al){throw new Error("Cannot set up gadgets.rpc receiver with ID: "+ai+", element not found.")}}var ah=al&&al.src;var aj=am||gadgets.rpc.getOrigin(ah);af(ai,aj);var an=gadgets.util.getUrlParameters(ah);var ak=ao||an.rpctoken;c(ai,ak)}function i(ah,aj,ak){if(ah===".."){var ai=ak||d.rpctoken||d.ifpctok||"";h(ai,aj)}else{o(ah,aj,ak)}}function w(aj){if(e==="bidir"||(e==="c2p"&&aj==="..")||(e==="p2c"&&aj!=="..")){var ai=window.location.href;var ak="?";if(p==="query"){ak="#"}else{if(p==="hash"){return ai}}var ah=ai.lastIndexOf(ak);ah=ah===-1?ai.length:ah;return ai.substring(0,ah)}return null}return{config:function(ah){if(typeof ah.securityCallback==="function"){J=ah.securityCallback}if(typeof ah.arbitrator==="function"){arbitrate=ah.arbitrator}},register:function(aj,ai){if(aj===M||aj===W){throw new Error("Cannot overwrite callback/ack service")}if(aj===V){throw new Error("Cannot overwrite default service: use registerDefault")}var ah=q[aj];q[aj]=ai;return ah},unregister:function(ah){if(ah===M||ah===W){throw new Error("Cannot delete callback/ack service")}if(ah===V){throw new Error("Cannot delete default service: use unregisterDefault")}delete q[ah]},registerDefault:function(ah){q[V]=ah},unregisterDefault:function(){delete q[V]},forceParentVerifiable:function(){if(!H.isParentVerifiable()){H=gadgets.rpctx.ifpc}},call:function(ah,aj,ao,am){ah=ah||"..";var an="..";if(ah===".."){an=v}else{if(ah.charAt(0)=="/"){an=C(v,gadgets.rpc.getOrigin(window.location.href))}}++z;if(ao){l[z]=ao}var al={s:aj,f:an,c:ao?z:0,a:Array.prototype.slice.call(arguments,3),t:B[ah],l:!!D[ah]};var ai=w(ah);if(ai){al.r=ai}if(ah!==".."&&y(ah)==null&&!document.getElementById(ah)){return}if(N(ah,al)){return}var ak=n[ah];if(!ak&&y(ah)!==null){ak=H}if(!ak){if(!E[ah]){E[ah]=[al]}else{E[ah].push(al)}return}if(D[ah]){ak=gadgets.rpctx.ifpc}if(ak.call(ah,an,al)===false){n[ah]=U;H.call(ah,an,al)}},getRelayUrl:P,setRelayUrl:af,setAuthToken:c,setupReceiver:i,getAuthToken:F,removeReceiver:function(ah){delete Z[ah];delete D[ah];delete B[ah];delete m[ah];delete T[ah];delete n[ah]},getRelayChannel:function(){return H.getCode()},receive:function(ai,ah){if(ai.length>4){H._receiveMessage(ai,ac)}else{j.apply(null,ai.concat(ah))}},receiveSameDomain:function(ah){ah.a=Array.prototype.slice.call(ah.a);window.setTimeout(function(){ac(ah)},0)},getOrigin:t,getTargetOrigin:L,init:function(){if(H.init(ac,k)===false){H=U}if(A){i("..")}else{gadgets.config.register("rpc",null,function(ai){var ah=ai.rpc||{};ae(ah);ad(ah)})}},_getTargetWin:ag,_parseSiblingId:y,ACK:W,RPC_ID:v||"..",SEC_ERROR_LOAD_TIMEOUT:Q,SEC_ERROR_FRAME_PHISH:ab,SEC_ERROR_FORGED_MSG:a}}();gadgets.rpc.init()}(function(){var a=function(){var c={};var b=[];var f=function(g,h){if(h&&g){b.push({key:g,request:h})}return c};var e=function(h){var g={method:h.request["method"],id:h.key};if(h.request["rpc"]){g.params=h.request["rpc"]}return g};var d=function(g){var h={};var q={};var l=0;var m=[];for(var o=0;o<b.length;o++){var k=b[o]["request"]["transport"];if(!q[k.name]){m.push(k);l++}q[k.name]=q[k.name]||[];q[k.name].push(e(b[o]))}var p=function(t){if(t.error){h.error=t.error}for(var s=0;s<b.length;s++){var r=b[s]["key"];var j=t[r];if(j){if(j.error){h[r]=j}else{h[r]=j.data||j.result}}}l--;if(l===0){g(h)}};for(var n=0;n<m.length;n++){m[n].execute(q[m[n]["name"]],p)}if(l==0){window.setTimeout(function(){g(h)},0)}};c.execute=d;c.add=f;return c};osapi.newBatch=a})();osapi._registerMethod=function(h,g){if(h==="newBatch"){return}var f=h.split(".");var d=osapi;for(var c=0;c<f.length-1;c++){d[f[c]]=d[f[c]]||{};d=d[f[c]]}var e=f[f.length-1],a;if(d[e]){a=d[e]}d[e]=function(j){j=j||{};j.userId=j.userId||"@viewer";j.groupId=j.groupId||"@self";var i=new osapi._BoundCall(h,g,j);return i};if(typeof tamings___!=="undefined"){var b=function(){caja___.markFunction(d[e],h)};if(a&&a.__taming_index){d[e].__taming_index=a.__taming_index;tamings___[a.__taming_index]=b}else{d[e].__taming_index=tamings___.length;tamings___.push(b)}}};osapi._BoundCall=function(c,b,a){this["method"]=c;this["transport"]=b;this["rpc"]=a};osapi._BoundCall.prototype.execute=function(e){var a=(typeof caja___!=="undefined"&&caja___.getUseless&&caja___.getUseless());var d=a?caja___.getUseless():this;var b=a?caja___.untame(e):e;var c=osapi.newBatch();c.add(this.method,this);c.execute(function(f){if(f.error){b.call(d,{error:f.error})}else{b.call(d,f[d.method])}})};tamings___.push(function(a){function b(){var c=osapi.newBatch();caja___.whitelistFuncs([[c,"add"],[c,"execute"]]);return caja___.tame(c)}caja___.markFunction(b,"newBatch");caja___.tamesTo(osapi.newBatch,b);caja___.whitelistCtors([[osapi,"_BoundCall",Object]]);caja___.whitelistMeths([[osapi._BoundCall,"execute"]])});(function(){var a;function b(j,i){function g(l){if(l.errors[0]){i({error:{code:l.rc,message:l.text}})}else{var m=l.result||l.data;if(m.error){i(m)}else{var k={};for(var n=0;n<m.length;n++){k[m[n]["id"]]=m[n]}i(k)}}}var f={POST_DATA:gadgets.json.stringify(j),CONTENT_TYPE:"JSON",METHOD:"POST",AUTHORIZATION:"SIGNED"};var h={"Content-Type":"application/json"};var d=this.name;var e=shindig.auth.getSecurityToken();if(e){if(a){h.Authorization="OAuth2 "+e}else{d+="?st=";d+=encodeURIComponent(e)}}gadgets.io.makeNonProxiedRequest(d,g,f,h)}function c(g){var j=g["osapi.services"];a=g["osapi.useOAuth2"];if(j){for(var f in j){if(j.hasOwnProperty(f)){if(f.indexOf("http")==0||f.indexOf("//")==0){var d=f.replace("%host%",document.location.host);var k={name:d,execute:b};var e=j[f];for(var h=0;h<e.length;h++){osapi._registerMethod(e[h],k)}}}}}}if(gadgets.config){gadgets.config.register("osapi.services",null,c)}})();gadgets.util.registerOnLoadHandler(function(){if(osapi&&osapi.people&&osapi.people.get){osapi.people.getViewer=function(a){a=a||{};a.userId="@viewer";a.groupId="@self";return osapi.people.get(a)};osapi.people.getViewerFriends=function(a){a=a||{};a.userId="@viewer";a.groupId="@friends";return osapi.people.get(a)};osapi.people.getOwner=function(a){a=a||{};a.userId="@owner";a.groupId="@self";return osapi.people.get(a)};osapi.people.getOwnerFriends=function(a){a=a||{};a.userId="@owner";a.groupId="@friends";return osapi.people.get(a)}}});tamings___.push(function(a){var b=a;gadgets.util.registerOnLoadHandler(function(){if(osapi&&osapi.people&&osapi.people.get){caja___.whitelistFuncs([[osapi.people,"getViewer"],[osapi.people,"getViewerFriends"],[osapi.people,"getOwner"],[osapi.people,"getOwnerFriends"]])}})});shindig.uri=(function(){var a=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?");return function(y){var r="";var n="";var c="";var h="";var d=null;var i="";var j=null;var l=window.decodeURIComponent?decodeURIComponent:unescape;var x=window.encodeURIComponent?encodeURIComponent:escape;var k=null;function u(A){if(A.match(a)===null){throw"Malformed URL: "+A}r=RegExp.$1;n=RegExp.$2;c=RegExp.$3;h=RegExp.$4;i=RegExp.$5}function t(F){var E=[];for(var C=0,A=F.length;C<A;++C){var B=F[C][0];var D=F[C][1];if(typeof D=="undefined"){continue}E.push(x(B)+(D!==null?"="+x(D):""))}return E.join("&")}function q(){if(d){h=t(d);d=null}return h}function z(){if(j){i=t(j);j=null}return i}function o(A){d=d||f(h);return s(d,A)}function w(A){j=j||f(i);return s(j,A)}function b(B,A){d=m(d||f(h),B,A);return k}function g(B,A){j=m(j||f(i),B,A);return k}function v(){return[r,r!==""?":":"",n!==""?"//":"",n].join("")}function p(){var B=q();var A=z();return[v(),c,B!==""?"?":"",B,A!==""?"#":"",A].join("")}function f(H){var G=[];if(H===""){return G}var F=H.split("&");for(var C=0,A=F.length;C<A;++C){var E=F[C].split("=");var B=E.shift();var D=null;if(E.length>0){D=E.join("").replace(/\+/g," ")}G.push([B,D!=null?l(D):null])}return G}function s(A,D){for(var C=0,B=A.length;C<B;++C){if(A[C][0]==D){return A[C][1]}}return undefined}function m(E,F,D){var H=F;if(typeof F==="string"){H={};H[F]=D}for(var C in H){var G=false;for(var B=0,A=E.length;!G&&B<A;++B){if(E[B][0]==C){E[B][1]=H[C];G=true}}if(!G){E.push([C,H[C]])}}return E}function e(B,A){B=B||"";if(B[0]===A){B=B.substr(A.length)}return B}if(typeof y==="object"&&typeof y.toString==="function"){u(y.toString())}else{if(y){u(y)}}k={getSchema:function(){return r},getAuthority:function(){return n},getOrigin:v,getPath:function(){return c},getQuery:q,getFragment:z,getQP:o,getFP:w,setSchema:function(A){r=A;return k},setAuthority:function(A){n=A;return k},setPath:function(A){if(typeof A!=="undefined"&&A!=null){c=(A[0]==="/"?"":"/")+A}return k},setQuery:function(A){d=null;h=e(A,"?");return k},setFragment:function(A){j=null;i=e(A,"#");return k},setQP:b,setFP:g,setExistingP:function(A,B){if(typeof(o(A,B))!="undefined"){b(A,B)}if(typeof(w(A,B))!="undefined"){g(A,B)}return k},toString:p};return k}})();shindig._uri=shindig.uri;shindig.uri=(function(){var c=shindig._uri;shindig._uri=null;function a(e,d){return e.getOrigin()==d.getOrigin()}function b(e,g){if(e.getSchema()==""){e.setSchema(g.getSchema())}if(e.getAuthority()==""){e.setAuthority(g.getAuthority())}var f=e.getPath();if(f==""||f.charAt(0)!="/"){var h=g.getPath();var d=h.lastIndexOf("/");if(d!=-1){h=h.substring(0,d+1)}e.setPath(g.getPath()+f)}}return function(d){var e=c(d);e.hasSameOrigin=function(f){return a(e,f)};e.resolve=function(f){return b(e,f)};return e}})();Function.prototype.inherits=function(a){function b(){}b.prototype=a.prototype;this.superClass_=a.prototype;this.prototype=new b();this.prototype.constructor=this};shindig.cookies={};shindig.cookies.JsType_={UNDEFINED:"undefined"};shindig.cookies.isDef=function(a){return typeof a!=shindig.cookies.JsType_.UNDEFINED};shindig.cookies.set=function(c,i,h,b,d){if(/;=/g.test(c)){throw new Error('Invalid cookie name "'+c+'"')}if(/;/g.test(i)){throw new Error('Invalid cookie value "'+i+'"')}if(!shindig.cookies.isDef(h)){h=-1}var f=d?";domain="+d:"";var j=b?";path="+b:"";var e;if(h<0){e=""}else{if(h===0){var g=new Date(1970,1,1);e=";expires="+g.toUTCString()}else{var a=new Date((new Date).getTime()+h*1000);e=";expires="+a.toUTCString()}}document.cookie=c+"="+i+f+j+e};shindig.cookies.get=function(b,g){var f=b+"=";var d=String(document.cookie);for(var h=-1;(h=d.indexOf(f,h+1))>=0;){var c=h;while(--c>=0){var e=d.charAt(c);if(e==";"){c=-1;break}}if(c==-1){var a=d.indexOf(";",h);if(a<0){a=d.length}return d.substring(h+f.length,a)}}return g};shindig.cookies.remove=function(b,a,c){var d=shindig.cookies.containsKey(b);shindig.cookies.set(b,"",0,a,c);return d};shindig.cookies.getKeyValues_=function(){var e=String(document.cookie);var g=e.split(/\s*;\s*/);var f=[],a=[],c,b;for(var d=0;b=g[d];d++){c=b.indexOf("=");if(c==-1){f.push("");a.push(b)}else{f.push(b.substring(0,c));a.push(b.substring(c+1))}}return{keys:f,values:a}};shindig.cookies.getKeys=function(){return shindig.cookies.getKeyValues_().keys};shindig.cookies.getValues=function(){return shindig.cookies.getKeyValues_().values};shindig.cookies.isEmpty=function(){return document.cookie===""};shindig.cookies.getCount=function(){var a=String(document.cookie);if(a===""){return 0}var b=a.split(/\s*;\s*/);return b.length};shindig.cookies.containsKey=function(b){var a={};return shindig.cookies.get(b,a)!==a};shindig.cookies.containsValue=function(c){var a=shindig.cookies.getKeyValues_().values;for(var b=0;b<a.length;b++){if(a[b]==c){return true}}return false};shindig.cookies.clear=function(){var b=shindig.cookies.getKeyValues_().keys;for(var a=b.length-1;a>=0;a--){shindig.cookies.remove(b[a])}};shindig.cookies.MAX_COOKIE_LENGTH=3950;shindig.errors={};shindig.errors.SUBCLASS_RESPONSIBILITY="subclass responsibility";shindig.errors.TO_BE_DONE="to be done";shindig.callAsyncAndJoin=function(e,a,d){var f=e.length;var c=[];for(var b=0;b<e.length;b++){var g=function(h){var i=e[h];if(typeof i==="string"){i=d[i]}i.call(d,function(j){c[h]=j;if(--f===0){a(c)}})};g(b)}};shindig.Extensible=function(){};shindig.Extensible.prototype.setDependencies=function(a){for(var b in a){this[b]=a[b]}};shindig.Extensible.prototype.getDependencies=function(a){return this[a]};shindig.UserPrefStore=function(){};shindig.UserPrefStore.prototype.getPrefs=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.UserPrefStore.prototype.savePrefs=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.DefaultUserPrefStore=function(){shindig.UserPrefStore.call(this)};shindig.DefaultUserPrefStore.inherits(shindig.UserPrefStore);shindig.DefaultUserPrefStore.prototype.getPrefs=function(a){};shindig.DefaultUserPrefStore.prototype.savePrefs=function(a){};shindig.GadgetService=function(){};shindig.GadgetService.prototype.setHeight=function(b,a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.GadgetService.prototype.setTitle=function(a,b){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.GadgetService.prototype.setUserPref=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.IfrGadgetService=function(){shindig.GadgetService.call(this);gadgets.rpc.register("resize_iframe",this.setHeight);gadgets.rpc.register("set_pref",this.setUserPref);gadgets.rpc.register("set_title",this.setTitle);gadgets.rpc.register("requestNavigateTo",this.requestNavigateTo);gadgets.rpc.register("requestSendMessage",this.requestSendMessage)};shindig.IfrGadgetService.inherits(shindig.GadgetService);shindig.IfrGadgetService.prototype.setHeight=function(a){if(a>shindig.container.maxheight_){a=shindig.container.maxheight_}var b=document.getElementById(this.f);if(b){b.style.height=a+"px"}};shindig.IfrGadgetService.prototype.setTitle=function(b){var a=document.getElementById(this.f+"_title");if(a){a.innerHTML=b.replace(/&/g,"&amp;").replace(/</g,"&lt;")}};shindig.IfrGadgetService.prototype.setUserPref=function(g,b,d){var f=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var e=shindig.container.getGadget(f);for(var c=1,a=arguments.length;c<a;c+=2){this.userPrefs[arguments[c]].value=arguments[c+1]}e.saveUserPrefs()};shindig.IfrGadgetService.prototype.requestSendMessage=function(a,d,b,c){if(b){window.setTimeout(function(){b(new opensocial.ResponseItem(null,null,opensocial.ResponseItem.Error.NOT_IMPLEMENTED,null))},0)}};shindig.IfrGadgetService.prototype.requestNavigateTo=function(a,d){var e=shindig.container.gadgetService.getGadgetIdFromModuleId(this.f);var b=shindig.container.gadgetService.getUrlForView(a);if(d){var c=gadgets.json.stringify(d);if(c.length>0){b+="&appParams="+encodeURIComponent(c)}}if(b&&document.location.href.indexOf(b)==-1){document.location.href=b}};shindig.IfrGadgetService.prototype.getUrlForView=function(a){if(a==="canvas"){return"/canvas"}else{if(a==="profile"){return"/profile"}else{return null}}};shindig.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(a){return parseInt(a.match(/_([0-9]+)$/)[1],10)};shindig.LayoutManager=function(){};shindig.LayoutManager.prototype.getGadgetChrome=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.StaticLayoutManager=function(){shindig.LayoutManager.call(this)};shindig.StaticLayoutManager.inherits(shindig.LayoutManager);shindig.StaticLayoutManager.prototype.setGadgetChromeIds=function(a){this.gadgetChromeIds_=a};shindig.StaticLayoutManager.prototype.getGadgetChrome=function(b){var a=this.gadgetChromeIds_[b.id];return a?document.getElementById(a):null};shindig.FloatLeftLayoutManager=function(a){shindig.LayoutManager.call(this);this.layoutRootId_=a};shindig.FloatLeftLayoutManager.inherits(shindig.LayoutManager);shindig.FloatLeftLayoutManager.prototype.getGadgetChrome=function(c){var b=document.getElementById(this.layoutRootId_);if(b){var a=document.createElement("div");a.className="gadgets-gadget-chrome";a.style.cssFloat="left";b.appendChild(a);return a}else{return null}};shindig.Gadget=function(b){this.userPrefs={};if(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}}if(!this.secureToken){this.secureToken="john.doe:john.doe:appid:cont:url:0:default"}};shindig.Gadget.prototype.setServerBase=function(a){this.serverBase_=a};shindig.Gadget.prototype.getServerBase=function(){return this.serverBase_};shindig.Gadget.prototype.getUserPrefs=function(){return this.userPrefs};shindig.Gadget.prototype.saveUserPrefs=function(){shindig.container.userPrefStore.savePrefs(this)};shindig.Gadget.prototype.getUserPrefValue=function(b){var a=this.userPrefs[b];return typeof(a.value)!="undefined"&&a.value!=null?a.value:a["default"]};shindig.Gadget.prototype.render=function(a){if(a){var b=this;this.getContent(function(c){a.innerHTML=c;b.finishRender(a)})}};shindig.Gadget.prototype.getContent=function(a){shindig.callAsyncAndJoin(["getTitleBarContent","getUserPrefsDialogContent","getMainContent"],function(b){a(b.join(""))},this)};shindig.Gadget.prototype.getTitleBarContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.Gadget.prototype.getUserPrefsDialogContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.Gadget.prototype.getMainContent=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.Gadget.prototype.finishRender=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.Gadget.prototype.getAdditionalParams=function(){return""};shindig.BaseIfrGadget=function(a){shindig.Gadget.call(this,a);if(!this.serverBase_){this.serverBase_="/gadgets/"}else{if(this.serverBase_.indexOf("/gadgets")<0){this.serverBase_+="/gadgets/"}}this.queryIfrGadgetType_()};shindig.BaseIfrGadget.inherits(shindig.Gadget);shindig.BaseIfrGadget.prototype.GADGET_IFRAME_PREFIX_="remote_iframe_";shindig.BaseIfrGadget.prototype.CONTAINER="default";shindig.BaseIfrGadget.prototype.cssClassGadget="gadgets-gadget";shindig.BaseIfrGadget.prototype.cssClassTitleBar="gadgets-gadget-title-bar";shindig.BaseIfrGadget.prototype.cssClassTitle="gadgets-gadget-title";shindig.BaseIfrGadget.prototype.cssClassTitleButtonBar="gadgets-gadget-title-button-bar";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialog="gadgets-gadget-user-prefs-dialog";shindig.BaseIfrGadget.prototype.cssClassGadgetUserPrefsDialogActionBar="gadgets-gadget-user-prefs-dialog-action-bar";shindig.BaseIfrGadget.prototype.cssClassTitleButton="gadgets-gadget-title-button";shindig.BaseIfrGadget.prototype.cssClassGadgetContent="gadgets-gadget-content";shindig.BaseIfrGadget.prototype.rpcToken=(2147483647*Math.random())|0;shindig.BaseIfrGadget.prototype.rpcRelay="../container/rpc_relay.html";shindig.BaseIfrGadget.prototype.getTitleBarContent=function(a){var b=this.hasViewablePrefs_()?'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleOpenUserPrefsDialog();return false;" class="'+this.cssClassTitleButton+'">settings</a> ':"";a('<div id="'+this.cssClassTitleBar+"-"+this.id+'" class="'+this.cssClassTitleBar+'"><span id="'+this.getIframeId()+'_title" class="'+this.cssClassTitle+'">'+(this.title?this.title:"Title")+'</span> | <span class="'+this.cssClassTitleButtonBar+'">'+b+'<a href="#" onclick="shindig.container.getGadget('+this.id+').handleToggle();return false;" class="'+this.cssClassTitleButton+'">toggle</a></span></div>')};shindig.BaseIfrGadget.prototype.getUserPrefsDialogContent=function(a){a('<div id="'+this.getUserPrefsDialogId()+'" class="'+this.cssClassGadgetUserPrefsDialog+'"></div>')};shindig.BaseIfrGadget.prototype.getMainContent=function(a){var b=this;window.setTimeout(function(){b.getMainContent(a)},0)};shindig.BaseIfrGadget.prototype.getIframeId=function(){return this.GADGET_IFRAME_PREFIX_+this.id};shindig.BaseIfrGadget.prototype.getUserPrefsDialogId=function(){return this.getIframeId()+"_userPrefsDialog"};shindig.BaseIfrGadget.prototype.getUserPrefsParams=function(){var b="";for(var a in this.getUserPrefs()){b+="&up_"+encodeURIComponent(a)+"="+encodeURIComponent(this.getUserPrefValue(a))}return b};shindig.BaseIfrGadget.prototype.handleToggle=function(){var b=document.getElementById(this.getIframeId());if(b){var a=b.parentNode;var c=a.style.display;a.style.display=c?"":"none"}};shindig.BaseIfrGadget.prototype.hasViewablePrefs_=function(){for(var b in this.getUserPrefs()){var a=this.userPrefs[b];if(a.type!="hidden"){return true}}return false};shindig.BaseIfrGadget.prototype.handleOpenUserPrefsDialog=function(){if(this.userPrefsDialogContentLoaded){this.showUserPrefsDialog()}else{var c=this;var b="ig_callback_"+this.id;window[b]=function(d){c.userPrefsDialogContentLoaded=true;c.buildUserPrefsDialog(d);c.showUserPrefsDialog()};var a=document.createElement("script");a.src="http://www.gmodules.com/ig/gadgetsettings?mid="+this.id+"&output=js"+this.getUserPrefsParams()+"&url="+this.specUrl;document.body.appendChild(a)}};shindig.BaseIfrGadget.prototype.buildUserPrefsDialog=function(a){var b=document.getElementById(this.getUserPrefsDialogId());b.innerHTML=a+'<div class="'+this.cssClassGadgetUserPrefsDialogActionBar+'"><input type="button" value="Save" onclick="shindig.container.getGadget('+this.id+').handleSaveUserPrefs()"> <input type="button" value="Cancel" onclick="shindig.container.getGadget('+this.id+').handleCancelUserPrefs()"></div>';b.childNodes[0].style.display=""};shindig.BaseIfrGadget.prototype.showUserPrefsDialog=function(a){var b=document.getElementById(this.getUserPrefsDialogId());b.style.display=(a||typeof a=="undefined")?"":"none"};shindig.BaseIfrGadget.prototype.hideUserPrefsDialog=function(){this.showUserPrefsDialog(false)};shindig.BaseIfrGadget.prototype.handleSaveUserPrefs=function(){this.hideUserPrefsDialog();var a=document.getElementById("m_"+this.id+"_numfields").value;for(var d=0;d<a;d++){var b=document.getElementById("m_"+this.id+"_"+d);var f="m_"+this.id+"_up_";var c=b.name.substring(f.length);var e=b.value;this.userPrefs[c].value=e}this.saveUserPrefs();this.refresh()};shindig.BaseIfrGadget.prototype.handleCancelUserPrefs=function(){this.hideUserPrefsDialog()};shindig.BaseIfrGadget.prototype.refresh=function(){var a=this.getIframeId();document.getElementById(a).src=this.getIframeUrl(Math.random())};shindig.BaseIfrGadget.prototype.queryIfrGadgetType_=function(){var c={context:{country:"default",language:"default",view:"default",container:"default"},gadgets:[{url:this.specUrl,moduleId:1}]};var b={CONTENT_TYPE:"JSON",METHOD:"POST",POST_DATA:gadgets.json.stringify(c)};var a=this.serverBase_+"metadata?st="+this.secureToken;gadgets.io.makeNonProxiedRequest(a,d,b,{"Content-Type":"application/javascript"});var e=this;function d(k){var l=false;var f=k.data.gadgets[0].features;for(var h=0;h<f.length;h++){if(f[h]==="pubsub-2"){l=true;break}}var j=l?shindig.OAAIfrGadget:shindig.IfrGadget;for(var g in j){if(j.hasOwnProperty(g)){e[g]=j[g]}}}};shindig.IfrGadget={getMainContent:function(a){var b=this.getIframeId();gadgets.rpc.setRelayUrl(b,this.serverBase_+this.rpcRelay);gadgets.rpc.setAuthToken(b,this.rpcToken);a('<div class="'+this.cssClassGadgetContent+'"><iframe id="'+b+'" name="'+b+'" class="'+this.cssClassGadget+'" src="about:blank" frameborder="no" scrolling="no"'+(this.height?' height="'+this.height+'"':"")+(this.width?' width="'+this.width+'"':"")+"></iframe></div>")},finishRender:function(a){window.frames[this.getIframeId()].location=this.getIframeUrl()},getIframeUrl:function(a){return this.serverBase_+"ifr?container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(shindig.container.parentUrl_?"&parent="+encodeURIComponent(shindig.container.parentUrl_):"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(a?"&r="+a:"")+"#rpctoken="+this.rpcToken+(this.hashData?"&"+this.hashData:"")}};shindig.OAAIfrGadget={getMainContent:function(a){a('<div id="'+this.cssClassGadgetContent+"-"+this.id+'" class="'+this.cssClassGadgetContent+'"></div>')},finishRender:function(a){var b={className:this.cssClassGadget,frameborder:"no",scrolling:"no"};if(this.height){b.height=this.height}if(this.width){b.width=this.width}new OpenAjax.hub.IframeContainer(gadgets.pubsub2router.hub,this.getIframeId(),{Container:{onSecurityAlert:function(d,c){gadgets.error("Security error for container "+d.getClientID()+" : "+c);d.getIframe().src="about:blank"}},IframeContainer:{parent:document.getElementById(this.cssClassGadgetContent+"-"+this.id),uri:this.getIframeUrl(),tunnelURI:shindig.uri(this.serverBase_+this.rpcRelay).resolve(shindig.uri(window.location.href)),iframeAttrs:b}})},getIframeUrl:function(a){return this.serverBase_+"ifr?container="+this.CONTAINER+"&mid="+this.id+"&nocache="+shindig.container.nocache_+"&country="+shindig.container.country_+"&lang="+shindig.container.language_+"&view="+shindig.container.view_+(this.specVersion?"&v="+this.specVersion:"")+(this.debug?"&debug=1":"")+this.getAdditionalParams()+this.getUserPrefsParams()+(this.secureToken?"&st="+this.secureToken:"")+"&url="+encodeURIComponent(this.specUrl)+(this.viewParams?"&view-params="+encodeURIComponent(gadgets.json.stringify(this.viewParams)):"")+(a?"&r="+a:"")+(this.hashData?"#"+this.hashData:"")}};shindig.Container=function(){this.gadgets_={};this.parentUrl_=document.location.href+"://"+document.location.host;this.country_="ALL";this.language_="ALL";this.view_="default";this.nocache_=1;this.maxheight_=2147483647};shindig.Container.inherits(shindig.Extensible);shindig.Container.prototype.gadgetClass=shindig.Gadget;shindig.Container.prototype.userPrefStore=new shindig.DefaultUserPrefStore();shindig.Container.prototype.gadgetService=new shindig.GadgetService();shindig.Container.prototype.layoutManager=new shindig.StaticLayoutManager();shindig.Container.prototype.setParentUrl=function(a){this.parentUrl_=a};shindig.Container.prototype.setCountry=function(a){this.country_=a};shindig.Container.prototype.setNoCache=function(a){this.nocache_=a};shindig.Container.prototype.setLanguage=function(a){this.language_=a};shindig.Container.prototype.setView=function(a){this.view_=a};shindig.Container.prototype.setMaxHeight=function(a){this.maxheight_=a};shindig.Container.prototype.getGadgetKey_=function(a){return"gadget_"+a};shindig.Container.prototype.getGadget=function(a){return this.gadgets_[this.getGadgetKey_(a)]};shindig.Container.prototype.createGadget=function(a){return new this.gadgetClass(a)};shindig.Container.prototype.addGadget=function(a){a.id=this.getNextGadgetInstanceId();this.gadgets_[this.getGadgetKey_(a.id)]=a};shindig.Container.prototype.addGadgets=function(a){for(var b=0;b<a.length;b++){this.addGadget(a[b])}};shindig.Container.prototype.renderGadgets=function(){for(var a in this.gadgets_){this.renderGadget(this.gadgets_[a])}};shindig.Container.prototype.renderGadget=function(a){throw Error(shindig.errors.SUBCLASS_RESPONSIBILITY)};shindig.Container.prototype.nextGadgetInstanceId_=0;shindig.Container.prototype.getNextGadgetInstanceId=function(){return this.nextGadgetInstanceId_++};shindig.Container.prototype.refreshGadgets=function(){for(var a in this.gadgets_){this.gadgets_[a].refresh()}};shindig.IfrContainer=function(){shindig.Container.call(this)};shindig.IfrContainer.inherits(shindig.Container);shindig.IfrContainer.prototype.gadgetClass=shindig.BaseIfrGadget;shindig.IfrContainer.prototype.gadgetService=new shindig.IfrGadgetService();shindig.IfrContainer.prototype.setParentUrl=function(a){if(!a.match(/^http[s]?:\/\//)){a=document.location.href.match(/^[^?#]+\//)[0]+a}this.parentUrl_=a};shindig.IfrContainer.prototype.renderGadget=function(b){var a=this.layoutManager.getGadgetChrome(b);b.render(a)};function init(a){var b=a["shindig-container"];shindig.Gadget.prototype.setServerBase(b.serverBase)}if(gadgets.config){gadgets.config.register("shindig-container",null,init)}shindig.container=new shindig.IfrContainer();if(gadgets&&gadgets.rpc){osapi._handleGadgetRpcMethod=function(a){var f=new Array(a.length);var e=0;var h=this.callback;var b=function(j,i){i({})};for(var d=0;d<a.length;d++){var g=osapi;if(a[d].method.indexOf("_")==-1){var k=a[d].method.split(".");for(var c=0;c<k.length;c++){if(g.hasOwnProperty(k[c])){g=g[k[c]]}else{g=b;break}}}else{g=b}g(a[d].params,function(j){return function(i){f[j]={id:a[j].id,data:i};e++;if(e==a.length){h(f)}}}(d))}};osapi.container={};osapi.container.listMethods=function(a,c){var b=[];recurseNames(osapi,"",5,b);c(b)};function recurseNames(c,d,e,b){if(e==0){return}for(var f in c){if(c.hasOwnProperty(f)){if(f.indexOf("_")==-1){var a=typeof(c[f]);if(a=="function"){b.push(d+f)}else{if(a=="object"){recurseNames(c[f],d+f+".",e-1,b)}}}}}}gadgets.rpc.register("osapi._handleGadgetRpcMethod",osapi._handleGadgetRpcMethod)};